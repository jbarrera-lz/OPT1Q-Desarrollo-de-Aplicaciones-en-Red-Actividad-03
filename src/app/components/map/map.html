<section class="input-section">

  <!-- Mapa -->
  <div class="map-container">
    <div class="map-frame">
      <div id="map"></div>
    </div>
  </div>

  <!-- Posición actual -->
  <div class="current-position">
    <label>Tu posición actual es (latitud, longitud):</label>
    <output id="latitude" name="latitude">
      {{ (coor$ | async)?.coor?.latitude }}º
    </output>
    <output id="longitude" name="longitude">
      {{ (coor$ | async)?.coor?.longitude }}º
    </output>
  </div>

  <!-- Radio del círculo -->
  <div class="radius-input">
    <label for="radius">Radio del círculo (metros):</label>
    <input
      type="number"
      id="radius"
      name="radius"
      [ngModel]="(coor$ | async)?.radius"
      min="1"
      max="99999"
      (ngModelChange)="mapRadius = $event; updateCircle(); updateShowCards()"
    />
  </div>

  <!-- Coordenadas manuales -->
  <div class="manual-input">
    <h3>Introducir coordenadas manualmente</h3>

    <label for="manualLat">Latitud:</label>
    <input
      id="manualLat"
      type="number"
      [(ngModel)]="manualLat"
      step="0.000001"
    />

    <label for="manualLon">Longitud:</label>
    <input
      id="manualLon"
      type="number"
      [(ngModel)]="manualLon"
      step="0.000001"
    />

    <button type="button" (click)="useManualLocation()">
      Usar coordenadas
    </button>
  </div>

  <!-- Filtros -->
  <div class="filters">
    <h3>Filtros</h3>

    <!-- Tipo de carburante -->
    <div>
      <label for="fuelType">Tipo de carburante:</label>
      <select id="fuelType" [(ngModel)]="selectedFuelType">
        <option [ngValue]="null">Todos</option>

        <!-- Valores alineados con getters de EstacionTerrestre -->
        <option value="gasolina95E5">Gasolina 95 E5</option>
        <option value="gasolina95E5Premium">Gasolina 95 E5 Premium</option>
        <option value="gasolina95E5E85">Gasolina 95 E85</option>
        <option value="gasolina98E5">Gasolina 98 E5</option>
        <option value="gasolina98E10">Gasolina 98 E10</option>
        <option value="gasoleoA">Gasóleo A</option>
        <option value="gasoleoPremium">Gasóleo A Premium</option>
        <option value="gasoleoB">Gasóleo B</option>
        <option value="glp">GLP</option>
        <option value="gnc">GNC</option>
        <option value="gnl">GNL</option>
        <option value="adblue">AdBlue</option>
        <!-- -->
      </select>
    </div>

    <!-- Lista blanca de marcas -->
    <div>
      <label for="includeBrands">
        Solo marcas:
      </label>
      <input
        id="includeBrands"
        type="text"
        [(ngModel)]="includeBrands"
        placeholder="Repsol, Cepsa, Shell"
      />
    </div>


    <!-- Lista negra de marcas -->
    <div>
      <label for="excludeBrands">
        Excluir marcas:
      </label>
      <input
        id="excludeBrands"
        type="text"
        [(ngModel)]="excludeBrands"
        placeholder="LowCostX, MarcaY"
      />
    </div>
    
    <div>
<button type="button" (click)="applyFilters()">
  Aplicar filtros
</button>
    </div>
  </div>


</section>

<section class="output-section">

  <h2>Resultados</h2>

  <!-- Resumen: más cercana y más barata -->
  <div class="summary">
    @if (nearestStation) {
      <p>
        Gasolinera más cercana:
        <strong>{{ nearestStation.rotulo }}</strong> ({{ nearestStation.municipio }} - {{ nearestStation.localidad }})
      </p>
    }

    @if (cheapestStation && selectedFuelType) {
      <p>
        Gasolinera más barata para
        <strong>{{ selectedFuelType }}</strong>:
        <p><strong>{{ cheapestStation.rotulo }}</strong> – {{ $any(cheapestStation)[selectedFuelType][0] }} €/L
      </p>
    }
  </div>

  <!-- Listado de gasolineras -->
  <div class="results">
    @if (visibleStations.length > 0) {
      @for (station of visibleStations; track station) {
        <app-eess-card [station]="station"></app-eess-card>
      }
    } @else {
      <p>No hay gasolineras que cumplan los filtros en este radio.</p>
    }
  </div>

</section>

## Introducción
---

El siguiente setup está pensado para equipos Linux (en mi caso, una máquina Ubuntu 24.04 LTS) con VS Code y la
extensión de __DevContainers__ instalada en tu instancia de VSCode.

## Generación de Certificados
---

El primer paso a seguir es el de crear tu propio certificado autofirmado para
tu entorno de desarrollo.

En la raíz de nuestro proyecto, entramos en la carpeta ```nginx```:

> ```shell
> $ cd /path/to/my/workspace/
> $ git clone https://github.com/jbarrera-lz/OPT1Q-Desarrollo-de-Aplicaciones-en-Red-Actividad-02.git
> $ cd /path/to/my/workspace/OPT1Q-Desarrollo-de-Aplicaciones-en-Red-Actividad-02/nginx
> ```

Y creamos el fichero ```v3_unir.ext``` con el siguiente comando:

> ```shell
> $ cat << V3_UNIR > ./v3_unir.ext
> [req]
> default_md = sha512
> prompt = no
> req_extensions = req_ext
> distinguished_name = req_distinguished_name
> 
> [req_distinguished_name]
> commonName = unir.development.es
> countryName = ES
> organizationName = UNIR GII PER-12824
> 
> [req_ext]
> keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
> extendedKeyUsage = serverAuth
> subjectAltName = @alt_names
> 
> [alt_names]
> DNS.1=unir.development.es
> V3_UNIR
> ```
Luego, usando ```openssl```, generaremos los ficheros necesarios:

> ```shell
> $ openssl genrsa -out ca.key 4096
> $ openssl req -x509 -new -nodes -sha512 -days 365 -key ca.key -out ca.crt -config v3_unir.ext
> $ openssl genrsa -out unir.development.key 4096
> $ openssl req -new -nodes -key unir.development.key -config v3_unir.ext -out unir.development.csr
> $ opeunir.development.crt nssl req -noout -text -in unir.development.csr
> $ openssl x509 -req -sha512 -days 365 -extfile v3_unir.ext -CA ca.crt -CAkey ca.key -CAcreateserial -in unir.development.csr -out unir.development.crt -extensions req_ext
> $ openssl x509 -inform PEM -in unir.development.crt -out unir.development.cert
> ```

### Actualizar ```/etc/hosts```

En tu máquina Linux, hay que editar el fichero ```/etc/hosts```

> ```shell
> $ sudo cat <<HOSTS >> /etc/hosts
> 127.0.0.1 unir.development.es
> HOSTS
> ```
### Navegador

Recordar que estos nuevos certificados hay que importarlos en el navegador de tu equipo de desarrollo.

## Creación de DevContainer
---
Para desplegar el entorno de desarrollo con ```DevContainers```, estando en la raíz del proyecto,
pulsa ```CTRL+SHIFT+p``` para abrir la paleta de comandos de ```VS Code```. 

Escribiendo  ```> DevContainers: Rebuild and Reopen in Container```, lanzamos una nueva instancia de VSCode
conectada al contenedor correspondiente al servicio ```web```, el cual se puede ver definido en el fichero
```Docker/docker-compose.yaml```.

Hay que entender que el tráfico va a ser redirigido a través del servicio ```proxy```, que es justo donde se realizará
la encriptación de los datos, pudiendo usar por tanto el protocolo ```https``` en nuestra aplicación.

Una vez desplagado el ```DevContainer```, actualizamos el fichero ```angular.json``` con la siguiente información:

> ```json
> ...
> "serve": {
>     "builder": "@angular/build:dev-server",
>     "configurations": {
>     "production": {
>         "buildTarget": "tutorial:build:production"
>     },
>     "development": {
>         "buildTarget": "tutorial:build:development"
>     }
>     },
>     "options": {
>         "allowedHosts": [ "unir.development.es" ]
>     },
>     "defaultConfiguration": "development"
> }
> ...
>```

Y finalmente, lanzamos nuestra aplicación

> ```shell
> $ cd /workspace
> $ ng serve --host 0.0.0.0 --port 4200 --open
> ```

